<!DOCTYPE html>
<html>
<head>
<title>TubePlayForElectron</title>
<meta charset=utf-8>
</head>
<body>
<script src="nico.js"></script>
	<script src="tube.js"></script>
	<div id="ytplayer"></div>
<script>
	<div class="NicoPlayer" id="NicoPlayer"></div>
var express = require('express');
var server= express();
url = require('url');
var nowPlayVideoID;
server.get('/operation.html', function(req, res){
	var suc=false;
	if (req.query.stop) {
		myPauseVideo();
		suc=true;
	}else if (req.query.play) {
		myPlayVideo();
		suc=true;
	}
	if (req.query.vol) {
		mySetVolume(req.query.vol);
		suc=true;
	}
	if (req.query.seek) {
		mySeekTo(req.query.seek);
		suc=true;
	}
	if(req.query.GETvolume){
		res.send(""+myGetVolume());
		return;
	}
	var index=0;
	if (req.query.index) {
		index=parseInt(req.query.index, 10);
	}
	if (req.query.v) {
		var videoID = req.query.v;
		//console.log(videoID);
		//alart("videoID="+videoID);
		loadVideo(videoID);
		suc=true;
		nowPlayVideoID=videoID;
	}else if (req.query.list) {
		var listID = req.query.list;
		//console.log(listID);
		//alart("listID="+listID);
		loadList(videoID,0);
		suc=true;
		nowPlayVideoID=listID;
	}else if (req.query.nico) {
		var videoID = req.query.nico;
		removeNicoPlayer();
		var nico=new NicovideoPlayer('body',videoID);
		suc=true;
		nowPlayVideoID=videoID;
	}
	if(suc)res.send(nowPlayVideoID);
	else res.send("失敗");
});
server.listen(7001);//サーバのポート 5050これは本番環境の時使うポートのメモ
function startServer(){
/*
var input_port = document.getElementById("input_port");
var port=parseInt(input_port.value, 10);
server.listen(port, function() {
    //console.log('Listening on port '+port);
});
*/
}
</script>
	<center>
		<!--<h1>TubePlayForElectron</h1>-->
		Port<input type="number" id="input_port" value="7000">
		<input type="button" id="submit" value="サーバ起動!" onclick="startServer();"></input>
		<!--<script src="server.js"></script>-->
	</center>
	<div style="margin-bottom: 5px;">
		<input type="button" name="btn1" value="ミュート(mute)"
			onclick="myMute();" /> <input type="button" name="btn2"
			value="ミュート解除(unMute)" onclick="myUnMute();" /> <input type="button"
			name="btn3" value="ミュート状態(isMuted)" onclick="myIsMuted();" />
	</div>
	<div>
		<input type="button" name="btn4" value="音量を設定(setVolume)"
			onclick="mySetVolume(30);" /> <input type="button" name="btn5"
			value="音量を取得(getVolume)" onclick="myGetVolume();" />
	</div>
	<div style="margin-bottom: 5px;">
		<input type="button" name="btn1" value="再生(playVideo)"
			onclick="myPlayVideo();" /> <input type="button" name="btn2"
			value="一時停止(pauseVideo)" onclick="myPauseVideo();" /> <input
			type="button" name="btn3" value="最初に移動(seekTo)"
			onclick="mySeekTo(0);" />
			<input type="button" name="btn4" value="alertLoopCount"
			onclick="alertLoopCount();" />
	</div>
<script>
	/*
var express = require('express');
var server= express();
url = require('url');
server.get('/tube.html', function(req, res){
	if (req.query.v) {
		var videoID = req.query.v;
		console.log(videoID);
		alart("videoID="+videoID);
		loadVideo(videoID);
		res.send("成功="+chat);
	}else res.send("失敗");
});
//var input_port = document.getElementById("input_port");
//var port=parseInt(input_port.value, 10);
//alart("port=7000");
server.listen(7000, function() {
	//console.log('Listening on port ');
});
*/
function removeNicoPlayer(){
    var np=document.getElementsByClassName('NicoPlayer');
    //子要素を全て削除
    var i = 0;
    while(np.length > i){
      n = np[i];
      while (n.firstChild !== null){
        n.removeChild(n.firstChild);
      }
      n.parentNode.removeChild(n);
      i++;
    }
//    while (np.firstChild != null){
//      np.removeChild(np.firstChild);
//    }
    //自分を削除
//    np.parentNode.removeChild(np);
}
function loadVideoNico(){
	removeNicoPlayer();
	var nico=new NicovideoPlayer('body',document.getElementById('videoID').value);
}
function loadVideoF(){
	loadVideo(document.getElementById('videoID').value);
}
</script>
	<p>動画ID=<input type="text" name="videoID" value="" id="videoID" />
	<input type="button"　name="btn3" value="ようつべ再生" onclick="loadVideoF();" />
	<input type="button"　name="btn3" value="ニコ動再生" onclick="loadVideoNico();" /></p>
	<!-- <input type="button" name="btn6" value="myGetTitle" onclick="myGetTitle();" />-->
</body>
</html>